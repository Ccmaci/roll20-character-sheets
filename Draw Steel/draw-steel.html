<div class="sheet-body">
	<div class="border">
		<h1 class="title">
			<img
				src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Draw%20Steel/images/powered_by_draw_steel.webp"
				alt="Powered By Draw Steel"
				style="height: 60px"
			/>
		</h1>
		<div class="header-panel">
			<div class="profile-panel border">
				<div class="name-input-group">
					<input type="text" name="attr_name" />
					<label class="sublabel" data-i18n="character-name"></label>
				</div>
				<div class="ancestry-input-group">
					<input type="text" class="input-md" name="attr_ancestry" />
					<label class="sublabel" data-i18n="ancestry"></label>
				</div>
				<div class="class-input-group">
					<input type="text" class="input-md" name="attr_class" />
					<label class="sublabel" data-i18n="class"></label>
				</div>
				<div class="career-input-group">
					<input type="text" class="input-md" name="attr_career" />
					<label class="sublabel" data-i18n="career"></label>
				</div>
				<div class="subclass-input-group">
					<input type="text" class="input-md" name="attr_subclass" />
					<label class="sublabel" data-i18n="subclass"></label>
				</div>
			</div>
			<div class="progress-panel border">
				<div class="victories-input-group">
					<h5 data-i18n="victories"></h5>
					<input type="number" name="attr_victories" />
				</div>
				<div class="level-input-group">
					<h5 data-i18n="level"></h5>
					<input type="number" name="attr_level" />
				</div>
				<div class="wealth-input-group">
					<label data-i18n="wealth"></label>
					<input type="number" class="input-md" name="attr_wealth" />
				</div>
				<div class="renown-input-group">
					<label data-i18n="renown"></label>
					<input type="number" class="input-md" name="attr_renown" />
				</div>
				<div class="experience-input-group">
					<label data-i18n="experience"></label>
					<input type="number" class="input-md" name="attr_experience" />
				</div>
			</div>
		</div>
	</div>
	<div class="v-spacer"></div>
	<div class="stats-panel border minimizable">
		<div class="minimize-control">
			<input id="stats-minimize-checkbox" class="minimize" type="checkbox" />
			<label for="stats-minimize-checkbox">Minimize Panel</label>
		</div>
		<div class="core-panel minimize-ignore">
			<div class="characteristics minimize-ignore">
				<div class="characteristic-input-group hexagon">
					<label data-characteristic="might" data-i18n="might"></label>
					<input type="number" name="attr_might" />
				</div>
				<div class="characteristic-input-group hexagon">
					<label data-characteristic="agility" data-i18n="agility"></label>
					<input type="number" name="attr_agility" />
				</div>
				<div class="characteristic-input-group hexagon">
					<label data-characteristic="reason" data-i18n="reason"></label>
					<input type="number" name="attr_reason" />
				</div>
				<div class="characteristic-input-group hexagon">
					<label data-characteristic="intuition" data-i18n="intuition"></label>
					<input type="number" name="attr_intuition" />
				</div>
				<div class="characteristic-input-group hexagon">
					<label data-characteristic="presence" data-i18n="presence"></label>
					<input type="number" name="attr_presence" />
				</div>
			</div>
			<div class="roller-wrapper popup-wrapper">
				<div class="overlay" data-popup-target="roller-wrapper"></div>
				<div class="popup-content">
					<h2>
						<input type="hidden" class="characteristic-i18n-switch" name="attr_roller_characteristic" />
						<span class="characteristic-i18n" data-i18n="might"></span>
						<span class="characteristic-i18n" data-i18n="agility"></span>
						<span class="characteristic-i18n" data-i18n="reason"></span>
						<span class="characteristic-i18n" data-i18n="intuition"></span>
						<span class="characteristic-i18n" data-i18n="presence"></span>
						<span>Power Roll</span>
					</h2>
					<div class="roller-edge-bane-select">
						<label>Double Bane</label>
						<label>Bane</label>
						<label></label>
						<label>Edge</label>
						<label>Double Edge</label>
						<input type="radio" name="attr_roller_edge_bane" value="double-bane" />
						<input type="radio" name="attr_roller_edge_bane" value="bane" />
						<input type="radio" name="attr_roller_edge_bane" value="" checked />
						<input type="radio" name="attr_roller_edge_bane" value="edge" />
						<input type="radio" name="attr_roller_edge_bane" value="double-edge" />
					</div>
					<div>
						<label>Bonus or Penalty</label>
						<input type="number" name="attr_roller_mod" />
					</div>
					<div>
						<button type="action" name="act_powerroll">Roll!</button>
					</div>
				</div>
			</div>
			<div class="potencies">
				<h5 class="panel-title" data-i18n="potencies"></h5>
				<div>
					<label data-i18n="potency-weak"></label>
					<input type="number" class="input-md" name="attr_potency_weak" />
					<label data-i18n="potency-average"></label>
					<input type="number" class="input-md" name="attr_potency_average" />
					<label data-i18n="potency-strong"></label>
					<input type="number" class="input-md" name="attr_potency_strong" />
				</div>
			</div>
			<div class="movement">
				<div class="movement-input-group">
					<input type="text" class="input-md" name="attr_size" />
					<label class="sublabel" data-i18n="size"></label>
				</div>
				<div class="movement-input-group">
					<input type="number" class="input-md" name="attr_speed" />
					<label class="sublabel" data-i18n="speed"></label>
				</div>
				<div class="movement-input-group">
					<input type="number" class="input-md" name="attr_disengage" />
					<label class="sublabel" data-i18n="disengage"></label>
				</div>
				<div class="movement-input-group">
					<input type="number" class="input-md" name="attr_stability" />
					<label class="sublabel" data-i18n="stability"></label>
				</div>
			</div>
		</div>
		<div class="stamina-panel">
			<h5 class="panel-title" data-i18n="stamina"></h5>
			<div class="stamina-input-group">
				<input type="number" name="attr_stamina" />
				<label class="sublabel" data-i18n="stamina-current"></label>
			</div>
			<input type="number" class="input-md" name="attr_stamina_max" />
			<label class="sublabel" data-i18n="stamina-max"></label>
			<input type="number" class="input-md" name="attr_stamina_winded" />
			<label class="sublabel" data-i18n="winded"></label>
			<div class="stamina-temporary-input-group">
				<input type="number" class="input-md" name="attr_stamina_temporary" />
				<label class="sublabel" data-i18n="stamina-temporary"></label>
			</div>
			<input type="number" class="input-md" disabled value="0" />
			<label class="sublabel" data-i18n="dying"></label>
			<input type="number" class="input-md" name="attr_stamina_dead" />
			<label class="sublabel" data-i18n="dead"></label>
		</div>
		<div class="recoveries-panel">
			<h5 class="panel-title" data-i18n="recoveries"></h5>
			<div class="recoveries-input-group">
				<input type="number" name="attr_recoveries" />
			</div>
			<div class="recovery-amount-input-group">
				<input type="number" class="input-md" name="attr_recovery_amount" />
				<label class="sublabel" data-i18n="recovery-amount"></label>
			</div>
			<div class="recoveries-max-input-group">
				<input type="number" class="input-md" name="attr_recoveries_max" />
				<label class="sublabel" data-i18n="recoveries-max"></label>
			</div>
		</div>
		<div class="damage-mod-panel">
			<label>Immunity</label>
			<input type="text" class="input-md" name="attr_immunity" />
			<label>Weakness</label>
			<input type="text" class="input-md" name="attr_weakness" />
		</div>
		<div class="resource-description-panel">
			<textarea data-i18n-placeholder="resource-description-placeholder" name="attr_resource_description"></textarea>
		</div>
		<div class="resource-panel">
			<h5 class="panel-title" data-i18n="resource"></h5>
			<div class="resource-input-group">
				<input type="number" name="attr_resource" />
			</div>
			<div class="resource-name-input-group">
				<input type="text" class="input-md" name="attr_resource_name" data-i18n-placeholder="resource-name-placeholder" />
			</div>
		</div>
		<div class="surges-panel">
			<h5 class="panel-title" data-i18n="surges"></h5>
			<div class="surges-input-group">
				<input type="number" name="attr_surges" />
			</div>
			<label class="sublabel">
				1 Surge = Damage <input type="number" class="input-sm" name="attr_surge_damage" />
			</label>
			<label class="sublabel">
				2 Surges = Potency + 1
			</label>
		</div>
		<div class="conditions-panel">
			<h5 class="panel-title" data-i18n="conditions"></h5>
			<fieldset class="repeating_conditions">
				<input type="text" name="attr_condition_name" data-i18n-placeholder="condition" />
				<div>
					<input type="radio" name="attr_end" value="eot" />
					<label data-i18n="eot"></label>
				</div>
				<div>
					<input type="radio" name="attr_end" value="save-ends" />
					<label data-i18n="save-ends"></label>
				</div>
			</fieldset>
		</div>
	</div>
	<div class="v-spacer"></div>
	<div class="biography-panel border minimizable">
		<div class="minimize-control">
			<input id="biography-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="biography-minimize-checkbox">Minimize Panel</label>
		</div>
		<div class="minimize-show">
			<h5 data-i18n="biography"></h5>
		</div>
		<div class="ancestry-panel">
			<h5 class="panel-title" data-i18n="ancestry"></h5>
			<code>TODO: ancestry</code>
		</div>
		<div class="culture-panel">
			<h5 class="panel-title" data-i18n="culture"></h5>
			<code>TODO: culture</code>
		</div>
		<div class="career-panel">
			<h5 class="panel-title" data-i18n="career"></h5>
			<code>TODO: career</code>
		</div>
		<div class="complication-panel">
			<h5 class="panel-title" data-i18n="complication"></h5>
			<code>TODO: complication</code>
		</div>
		<div class="class-panel">
			<h5 class="panel-title" data-i18n="class"></h5>
			<code>TODO: class</code>
		</div>
		<div class="perks-panel">
			<h5 class="panel-title" data-i18n="perks"></h5>
			<code>TODO: perks</code>
		</div>
		<div class="titles-panel">
			<h5 class="panel-title" data-i18n="titles"></h5>
			<code>TODO: titles</code>
		</div>
	</div>
	<div class="v-spacer"></div>
	<div class="skills-languages-panel border minimizable">
		<div class="minimize-control">
			<input id="skills-languages-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="skills-languages-minimize-checkbox">Minimize Panel</label>
		</div>
		<div class="minimize-show">
			<h5 data-i18n="skills-languages"></h5>
		</div>
		<div class="skills-panel">
			<h5 class="panel-title" data-i18n="skills"></h5>
			<label data-i18n="crafting"></label>
			<input type="text" name="attr_skills_crafting" />
			<label data-i18n="exploration"></label>
			<input type="text" name="attr_skills_exploration" />
			<label data-i18n="interpersonal"></label>
			<input type="text" name="attr_skills_interpersonal" />
			<label data-i18n="intrigue"></label>
			<input type="text" name="attr_skills_intrigue" />
			<label data-i18n="lore"></label>
			<input type="text" name="attr_skills_lore" />
		</div>
		<div class="languages-panel">
			<h5 class="panel-title" data-i18n="languages"></h5>
			<input type="text" data-i18n-placeholder="caelian" name="attr_languages" />
		</div>
	</div>
	<div class="v-spacer"></div>
	<div class="combat-panel border minimizable">
		<div class="minimize-control">
			<input id="combat-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="combat-minimize-checkbox">Minimize Panel</label>
		</div>
		<div class="minimize-show">
			<h5 data-i18n="modifiers-abilities"></h5>
		</div>
		<div class="modifiers-panel">
			<h5 class="panel-title" data-i18n="modifiers"></h5>
			<fieldset class="repeating_modifiers">
				<div class="modifier-card">
					<input type="text" class="modifier-all modifier-name" data-i18n-placeholder="modifier-name" name="attr_modifier_name" />
					<select class="modifier-all modifier-type" name="attr_modifier_type">
						<option value="basic" data-i18n="modifier-basic" selected></option>
						<option value="kit" data-i18n="kit"></option>
					</select>
					<div class="kit input-group kit-weapon-input-group">
						<input type="text" class="kit kit-weapon" name="attr_kit_weapon" />
						<label class="sublabel" data-i18n="weapon-implement"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-speed" name="attr_kit_speed" />
						<label class="sublabel" data-i18n="speed"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-melee-distance" name="attr_kit_melee_distance" />
						<label class="sublabel" data-i18n="melee"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-ranged-distance" name="attr_kit_ranged_distance" />
						<label class="sublabel" data-i18n="ranged"></label>
					</div>
					<div class="kit input-group kit-armor-input-group">
						<input type="text" class="kit kit-armor" name="attr_kit_armor" />
						<label class="sublabel" data-i18n="armor"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-disengage" name="attr_kit_disengage" />
						<label class="sublabel" data-i18n="disengage"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-stability" name="attr_kit_stability" />
						<label class="sublabel" data-i18n="stability"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-stamina" name="attr_kit_stamina" />
						<label class="sublabel" data-i18n="stamina"></label>
					</div>
					<label class="kit kit-damage-label sublabel" data-i18n="melee-weapon-damage"></label>
					<textarea class="modifier-all modifier-description"></textarea>
					<div class="kit input-group kit-melee-damage-1-input-group">
						<input type="number" class="kit-melee-damage-1" name="attr_kit_melee_damage_1" />
						<label class="sublabel">≤11</label>
					</div>
					<div class="kit input-group kit-melee-damage-2-input-group">
						<input type="number" class="kit-melee-damage-2" name="attr_kit_melee_damage_2" />
						<label class="sublabel">12-16</label>
					</div>
					<div class="kit input-group kit-melee-damage-3-input-group">
						<input type="number" class="kit-melee-damage-3" name="attr_kit_melee_damage_3" />
						<label class="sublabel">17+</label>
					</div>
					<label class="kit kit-damage-label sublabel" data-i18n="ranged-weapon-damage"></label>
					<div class="kit input-group kit-ranged-damage-1-input-group">
						<input type="number" class="kit-ranged-damage-1" name="attr_kit_ranged_damage_1" />
						<label class="sublabel">≤11</label>
					</div>
					<div class="kit input-group kit-ranged-damage-2-input-group">
						<input type="number" class="kit-ranged-damage-2" name="attr_kit_ranged_damage_2" />
						<label class="sublabel">12-16</label>
					</div>
					<div class="kit input-group kit-ranged-damage-3-input-group">
						<input type="number" class="kit-ranged-damage-3" name="attr_kit_ranged_damage_3" />
						<label class="sublabel">17+</label>
					</div>
				</div>
			</fieldset>
		</div>
		<div class="abilities-panel">
			<h5 class="panel-title" data-i18n="abilities"></h5>
			<div class="free-strikes">
				<div class="ability-card">
					<input type="text" class="ability-name" data-i18n-placeholder="melee-free-strike" name="attr_melee_free_strike_name" />
					<input type="text" class="ability-keywords" data-i18n-placeholder="melee-free-strike-keywords" name="attr_melee_free_strike_keywords" />
					<select class="ability-type" disabled>
						<option value="mainAction" selected data-i18n="main-action"></option>
						<option value="maneuver" data-i18n="maneuver"></option>
						<option value="triggered-action" data-i18n="triggered-action"></option>
					</select>
					<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_melee_free_strike_distance" />
					<input type="text" class="ability-target" data-i18n-placeholder="one-creature-object" name="attr_melee_free_strike_target" />
					<div class="power-roll">
						<div class="power-roll-mods">
							<label data-i18n="power-roll"></label>
							<span>+</span>
							<input type="text" class="power-roll-characteristic" data-i18n-placeholder="might-or-agility" name="attr_melee_free_strike_characteristic" />
						</div>
						<label class="sublabel">≤11</label>
						<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_1" />
						<label class="sublabel">12-16</label>
						<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_2" />
						<label class="sublabel">17+</label>
						<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_3" />
					</div>
				</div>
				<div class="ability-card">
					<input type="text" class="ability-name" data-i18n-placeholder="ranged-free-strike" name="attr_ranged_free_strike_name" />
					<input type="text" class="ability-keywords" data-i18n-placeholder="ranged-free-strike-keywords" />
					<select class="ability-type" disabled>
						<option value="mainAction" selected data-i18n="main-action"></option>
						<option value="maneuver" data-i18n="maneuver"></option>
						<option value="triggered-action" data-i18n="triggered-action"></option>
					</select>
					<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_ranged_free_strike_distance" />
					<input type="text" class="ability-target" data-i18n-placeholder="one-creature-object" name="attr_ranged_free_strike_target" />
					<div class="power-roll">
						<div class="power-roll-mods">
							<label data-i18n="power-roll"></label>
							<span>+</span>
							<input type="text" class="power-roll-characteristic" data-i18n-placeholder="might-or-agility" name="attr_ranged_free_strike_characteristic" />
						</div>
						<label class="sublabel">≤11</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_1" />
						<label class="sublabel">12-16</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_2" />
						<label class="sublabel">17+</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_3" />
					</div>
				</div>
			</div>
			<fieldset class="repeating_abilities">
				<div class="ability-card">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_ability_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_ability_cost" />
					</div>
					<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_ability_description" />
					<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_ability_keywords" />
					<select class="ability-type" name="attr_ability_type">
						<option value="" selected data-i18n="no-action"></option>
						<option value="main-action" data-i18n="main-action"></option>
						<option value="maneuver" data-i18n="maneuver"></option>
						<option value="free-maneuver" data-i18n="free-maneuver"></option>
						<option value="move" data-i18n="move-action"></option>
						<option value="triggered-action" data-i18n="triggered-action"></option>
						<option value="free-triggered-action" data-i18n="free-triggered-action"></option>
					</select>
					<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_ability_distance" />
					<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_ability_target" />
					<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_ability_trigger"></textarea>
					<div class="power-roll">
						<div class="power-roll-mods">
							<input type="checkbox" name="attr_has_power_roll" />
							<label data-i18n="power-roll"></label>
							<span>+</span>
							<input type="text" class="power-roll-characteristic" name="attr_ability_characteristic" />
						</div>
						<label class="sublabel">≤11</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_1" />
						<label class="sublabel">12-16</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_2" />
						<label class="sublabel">17+</label>
						<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_3" />
					</div>
					<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_ability_effect"></textarea>
				</div>
			</fieldset>
		</div>
	</div>
	<div class="v-spacer"></div>
	<div class="projects-panel border minimizable">
		<div class="minimize-control">
			<input id="projects-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="projects-minimize-checkbox">Minimize Panel</label>
		</div>
		<div class="minimize-show">
			<h5 data-i18n="projects"></h5>
		</div>
		<code>TODO: projects</code>
	</div>
	<code>TODO: TOC?, import Forge Steel</code>
	<div style="font-family: Menlo, Monaco, Consolas">This Draw Steel character sheet for Roll20 is an independent product published under the DRAW STEEL Creator License and is not affiliated with MCDM Productions, LLC. DRAW STEEL © 2024 MCDM Productions, LLC.</div>
</div>
<rolltemplate class="sheet-rolltemplate-power">
	<div class="sheet-template-body">
		{{#rollGreater() computed::rawDice 18}}
			<div class="sheet-template-crit">Critical</div>
		{{/rollGreater() computed::rawDice 18}}
		<div class="sheet-template-result">
			Tier
			{{computed::roll}}
			Result
		</div>
	</div>
</rolltemplate>
<script type="text/worker">
	function setActiveCharacterId(id) {
		const ocid = getActiveCharacterId();
		const data = {
			id: '0',
			type: 'setActiveCharacter',
			data: id,
		};
		if (self.dispatchEvent) {
			const event = new CustomEvent('message');
			event.data = data;
			self.dispatchEvent(event);
		}
		else {
			self.onmessage({ data });
		}
		return ocid;
	}
	function getAttrsAsync(props) {
		const acid = getActiveCharacterId();
		let ocid = null;
		return new Promise((resolve, reject) => {
			ocid = setActiveCharacterId(acid);
			try {
				getAttrs(props, (values) => resolve(values));
			}
			catch {
				reject();
			}
		}).finally(() => {
			setActiveCharacterId(ocid);
		});
	}
	function setAttrsAsync(props) {
		const acid = getActiveCharacterId();
		let ocid = null;
		return new Promise((resolve, reject) => {
			ocid = setActiveCharacterId(acid);
			try {
				setAttrs(props, undefined, (values) => resolve(values));
			}
			catch {
				reject();
			}
		}).finally(() => {
			setActiveCharacterId(ocid);
		});
	}
	$20('.characteristic-input-group > label').on('click', async (e) => {
		await setAttrsAsync({
			roller_characteristic: e.htmlAttributes['data-characteristic'],
			roller_edge_bane: '',
			roller_mod: 0,
		});
		$20('.roller-wrapper').addClass('show');
	});
	$20('.overlay').on('click', (e) => {
		$20(`.${e.htmlAttributes['data-popup-target']}`).removeClass('show');
	});
	on("clicked:powerroll", async () => {
		const attrs = await getAttrsAsync([
			'roller_characteristic', 'roller_edge_bane', 'roller_mod',
			'might', 'agility', 'reason', 'intuition', 'presence',
		]);
		const characteristicValue = attrs[attrs.roller_characteristic];
		const characteristicTranslation = getTranslationByKey(attrs.roller_characteristic);
		const modifier = (() => {
			if (!attrs.roller_mod) {
				return '';
			}
			return attrs.roller_mod > 0
				? ` + ${attrs.roller_mod} [Bonus]`
				: ` - ${0 - attrs.roller_mod} [Penalty]`;
		})();
		const edgeBaneMod = (() => {
			switch (attrs.roller_edge_bane) {
				case 'bane':
					return ' - 2 [Bane]';
				case 'edge':
					return ' + 2 [Edge]';
				default:
					return '';
			}
		})();
		startRoll(
			`&{template:power} {{roll=[[` +
				`2d10 + ${characteristicValue} [${characteristicTranslation}]` +
				modifier + edgeBaneMod +
				`]]}} {{rawDice=[[0]]}} {{edgeBane=todo}}`,
			(roll) => {
				const doubleEdgeBane = (() => {
					switch (attrs.roller_edge_bane) {
						case 'double-bane':
							return -1;
						case 'double-edge':
							return 1;
						default:
							return 0;
					}
				})();
				finishRoll(
					roll.rollId,
					{
						rawDice: roll.results.roll.dice.reduce((sum, d) => sum + d, 0),
						roll: (() => {
							if (roll.results.roll.result >= 17) {
								return Math.min(3 + doubleEdgeBane, 3);
							}
							if (roll.results.roll.result >= 12) {
								return 2 + doubleEdgeBane;
							}
							return Math.max(1 + doubleEdgeBane, 1);
						})(),
					}
				);
			}
		);
	});
</script>
