<input name="attr_version" type="hidden" value="1"/><input name="attr_latest_versioning_upgrade" type="hidden" value="1"/><input class="type" name="attr_sheet_type" type="hidden" value="character"/><input class="display_string" name="attr_character_settings" type="hidden" value=""/><div class="pc p-2 w-full h-full"><input type="hidden" name="attr_tab" value="main"/><div class="header grid gap-6 mb-4"><div class="flex flex-wrap flex-row gap-4"><div class="logo grow-0"><img src="images/logo.png"/></div><div class="grid gap-1 grow bio"><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="character name"></h2><label data-i18n-title="enter character name" title="enter character name"><input data-i18n-placeholder="character name" name="attr_character_name" placeholder="character name" title="@{character_name}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="lineage"></h2><label data-i18n-title="enter lineage" title="enter lineage"><input data-i18n-placeholder="lineage" name="attr_lineage" placeholder="lineage" title="@{lineage}" type="text" value=""/></label></div></div><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="level"></h2><label data-i18n-title="enter level" title="enter level"><input data-i18n-placeholder="level" name="attr_level" placeholder="level" title="@{level}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="height"></h2><label data-i18n-title="enter height" title="enter height"><input data-i18n-placeholder="height" name="attr_height" placeholder="height" title="@{height}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="weight"></h2><label data-i18n-title="enter weight" title="enter weight"><input data-i18n-placeholder="weight" name="attr_weight" placeholder="weight" title="@{weight}" type="text" value=""/></label></div></div><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="eye color"></h2><label data-i18n-title="enter eye color" title="enter eye color"><input data-i18n-placeholder="eye color" name="attr_eye_color" placeholder="eye color" title="@{eye_color}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="hair color"></h2><label data-i18n-title="enter hair color" title="enter hair color"><input data-i18n-placeholder="hair color" name="attr_hair_color" placeholder="hair color" title="@{hair_color}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="other"></h2><label data-i18n-title="enter other" title="enter other"><input data-i18n-placeholder="other" name="attr_other" placeholder="other" title="@{other}" type="text" value=""/></label></div></div></div></div><div class="grid gap-2 grid-flow-col auto-cols-min"><div class="grid radio-button"><input type="radio" name="attr_tab" value="main" checked="checked"/><span data-i18n="main"></span></div><div class="grid radio-button"><input type="radio" name="attr_tab" value="combat"/><span data-i18n="combat"></span></div><div class="grid radio-button"><input type="radio" name="attr_tab" value="magic"/><span data-i18n="magic"></span></div><div class="grid radio-button"><input type="radio" name="attr_tab" value="journal"/><span data-i18n="journal"></span></div></div></div><div class="grid gap-6 main"><div class="div"><h2 class="text-center" data-i18n="personality / background"></h2><textarea name="attr_personality_background" placeholder="personality background"></textarea></div><div class="grid gap-4 justify-between items-center attributes"><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="str"></h3><label data-i18n-title="enter str" title="enter str"><input name="attr_str" title="@{str}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_str_skills_bonus" placeholder="str skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="dex"></h3><label data-i18n-title="enter dex" title="enter dex"><input name="attr_dex" title="@{dex}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_dex_skills_bonus" placeholder="dex skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="end"></h3><label data-i18n-title="enter end" title="enter end"><input name="attr_end" title="@{end}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_end_skills_bonus" placeholder="end skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="luck"></h3><label data-i18n-title="enter luck" title="enter luck"><input name="attr_luck" title="@{luck}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_luck_skills_bonus" placeholder="luck skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="awr"></h3><label data-i18n-title="enter awr" title="enter awr"><input name="attr_awr" title="@{awr}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_awr_skills_bonus" placeholder="awr skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="int"></h3><label data-i18n-title="enter int" title="enter int"><input name="attr_int" title="@{int}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_int_skills_bonus" placeholder="int skills bonus"></textarea></div></div><div class="grid attribute justify-center items-center border"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="cha"></h3><label data-i18n-title="enter cha" title="enter cha"><input name="attr_cha" title="@{cha}" type="number" value=""/></label></div><div class="box grid justify-center items-center skill"><h3 class="text-center" data-i18n="skills/bonus"></h3><textarea name="attr_cha_skills_bonus" placeholder="cha skills bonus"></textarea></div></div><div class="grid justify-center items-center border relative"><div class="grid justify-center items-center currency-header absolute"><h2 class="text-center font-bold" data-i18n="currency"></h2></div><div class="box grid justify-center items-center h-full w-full"><textarea name="attr_currency" placeholder="currency"></textarea></div></div></div><div class="grid grid-flow-col grid-cols-2 gap-4"><div class="grid gap-4 inventory content-start"><h2 class="text-center" data-i18n="inventory"></h2><fieldset class="repeating_inventory"><div class="grid descriptor relative gap-1"><input class="flag" name="attr_flag" title="edit flag" type="checkbox" value="true" checked="checked"/><span class="pictos">p</span><div class="grid grid-flow-col gap-4"><div class="grid col-auto-fr gap-2"><h3 data-i18n="name"></h3><span class="display" name="attr_name"></span><label data-i18n-title="enter name" title="enter name"><input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{name}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-2"><h3 data-i18n="qty"></h3><span class="display text-center" name="attr_qty"></span><label data-i18n-title="enter qty" title="enter qty"><input data-i18n-placeholder="qty" name="attr_qty" placeholder="qty" title="@{qty}" type="text" value=""/></label></div></div><button class="chat" name="roll_item" type="roll" value="&{template:rolls} {{header=@{name}}} {{dice=@{notes}}}"><span class="pictos">q</span></button><div class="grid notes"><span class="display pl-4" name="attr_notes"></span><textarea name="attr_notes" placeholder="notes"></textarea></div></div></fieldset></div><div class="grid gap-4 talents content-start"><h2 class="text-center" data-i18n="talents"></h2><fieldset class="repeating_talents"><div class="grid descriptor relative gap-1"><input class="flag" name="attr_flag" title="edit flag" type="checkbox" value="true" checked="checked"/><span class="pictos">p</span><div class="grid grid-flow-col gap-4"><div class="grid col-auto-fr gap-2"><h3 data-i18n="name"></h3><span class="display" name="attr_name"></span><label data-i18n-title="enter name" title="enter name"><input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{name}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-2"><h3 data-i18n="level"></h3><span class="display text-center" name="attr_level"></span><label data-i18n-title="enter level" title="enter level"><input data-i18n-placeholder="level" name="attr_level" placeholder="level" title="@{level}" type="text" value=""/></label></div></div><button class="chat" name="roll_name" type="roll" value="&{template:rolls} {{header=@{name}}} {{dice=@{notes}}}"><span class="pictos">q</span></button><div class="grid notes"><span class="display pl-4" name="attr_notes"></span><textarea name="attr_notes" placeholder="notes"></textarea></div></div></fieldset></div></div><div class="div"><h2 class="text-center" data-i18n="bop / lineage abilities"></h2><textarea name="attr_abilities" placeholder="abilities"></textarea></div></div><div class="grid gap-6 magic"></div><div class="grid gap-6 combat"><div class="grid grid-flow-col"><div class="hit-points grid double-border-2 rounded-md"><div class="max grid justify-center p-2"><h2 class="text-center" data-i18n="max hp"></h2><label data-i18n-title="enter max hp" title="enter max hp"><input name="attr_max_hp" title="@{max_hp}" type="number" value=""/></label></div><div class="grid grid-flow-col"><div class="grid hp justify-center p-2"><h2 class="text-center" data-i18n="hp"></h2><label data-i18n-title="enter hp" title="enter hp"><input name="attr_hp" title="@{hp}" type="number" value=""/></label></div><div class="grid justify-center p-2"><h2 class="text-center" data-i18n="shield"></h2><label data-i18n-title="enter shield" title="enter shield"><input name="attr_shield" title="@{shield}" type="number" value=""/></label></div></div></div><div class="grid justify-center grid-flow-col gap-4"><div class="grid"><div class="double-border-2 p-2 justify-center rounded-md"><label data-i18n-title="enter armor rating" title="enter armor rating"><input name="attr_armor_rating" title="@{armor_rating}" type="number" value=""/></label></div><h2 class="text-center" data-i18n="armor rating"></h2></div><div class="grid"><div class="double-border-2 p-2 justify-center rounded-md"><label data-i18n-title="enter speed" title="enter speed"><input name="attr_speed" title="@{speed}" type="number" value=""/></label></div><h2 class="text-center" data-i18n="speed"></h2></div><div class="grid"><div class="double-border-2 p-2 justify-center rounded-md"><label data-i18n-title="enter death points" title="enter death points"><input name="attr_death_points" title="@{death_points}" type="number" value=""/></label></div><h2 class="text-center" data-i18n="death points"></h2></div></div></div><div class="grid grid-flow-col"><div class="grid"><div class="double-border-2 p-2 justify-center rounded-md"><label data-i18n-title="enter ap/rounded" title="enter ap/rounded"><input name="attr_ap/rounded" title="@{ap/rounded}" type="number" value=""/></label></div><h2 class="text-center" data-i18n="ap/rounded"></h2></div><div class="grid"><div class="grid grid-flow-col gap-2"><h2 class="text-center" data-i18n="special action points"></h2><label data-i18n-title="enter special action points" title="enter special action points"><input name="attr_special_action_points" title="@{special_action_points}" type="number" value=""/></label></div><div class="grid grid-flow-col"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span></div></div></div><div class="grid gap-4 justify-between items-center attributes"><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="str"></h2><label data-i18n-title="enter str" title="enter str"><input name="attr_str" title="@{str}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="dex"></h2><label data-i18n-title="enter dex" title="enter dex"><input name="attr_dex" title="@{dex}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="end"></h2><label data-i18n-title="enter end" title="enter end"><input name="attr_end" title="@{end}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="awr"></h2><label data-i18n-title="enter awr" title="enter awr"><input name="attr_awr" title="@{awr}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="int"></h2><label data-i18n-title="enter int" title="enter int"><input name="attr_int" title="@{int}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="cha"></h2><label data-i18n-title="enter cha" title="enter cha"><input name="attr_cha" title="@{cha}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="luck"></h2><label data-i18n-title="enter luck" title="enter luck"><input name="attr_luck" title="@{luck}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center"><div class="circle rounded-full border grid justify-center items-center font-bold"><h2 class="text-center" data-i18n="cor"></h2><label data-i18n-title="enter cor" title="enter cor"><input name="attr_cor" title="@{cor}" type="number" value=""/></label></div></div><div></div><div class="grid relative justify-center items-center ref"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="ref"></h3><label data-i18n-title="enter ref" title="enter ref"><input name="attr_ref" title="@{ref}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center for"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="for"></h3><label data-i18n-title="enter for" title="enter for"><input name="attr_for" title="@{for}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center ant"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="ant"></h3><label data-i18n-title="enter ant" title="enter ant"><input name="attr_ant" title="@{ant}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center log"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="log"></h3><label data-i18n-title="enter log" title="enter log"><input name="attr_log" title="@{log}" type="number" value=""/></label></div></div><div class="grid relative justify-center items-center wil"><div class="circle rounded-full border grid justify-center items-center font-bold"><h3 class="text-center" data-i18n="wil"></h3><label data-i18n-title="enter wil" title="enter wil"><input name="attr_wil" title="@{wil}" type="number" value=""/></label></div></div></div><div class="grid gap-4 grid-flow-col"> <div class="grid double-border-2 rounded-md"><h2 class="text-center" data-i18n="attacks &amp; spellcasting"></h2></div><div class="grid gap-4"><div class="grid double-border-2 rounded-md content-start p-2 reactive"><h2 class="text-center" data-i18n="reactive actions"></h2><fieldset class="repeating_reactive_actions"><div class="grid descriptor relative gap-1"><input class="flag" name="attr_flag" title="edit flag" type="checkbox" value="true" checked="checked"/><span class="pictos">p</span><div class="grid grid-flow-col gap-4"><div class="grid col-auto-fr gap-2"><h3 data-i18n="name"></h3><span class="display" name="attr_name"></span><label data-i18n-title="enter name" title="enter name"><input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{name}" type="text" value=""/></label></div></div><button class="chat" name="roll_name" type="roll" value="&{template:rolls} {{header=@{name}}} {{dice=@{notes}}}"><span class="pictos">q</span></button><div class="grid notes"><span class="display pl-4" name="attr_notes"></span><textarea name="attr_notes" placeholder="notes"></textarea></div></div></fieldset></div><div class="grid double-border-2 rounded-md conditions p-2"><h2 class="text-center" data-i18n="conditions"></h2><fieldset class="repeating_conditions"><div class="grid descriptor relative gap-1"><input class="flag" name="attr_flag" title="edit flag" type="checkbox" value="true" checked="checked"/><span class="pictos">p</span><div class="grid grid-flow-col gap-4"><div class="grid col-auto-fr gap-2"><h3 data-i18n="name"></h3><span class="display" name="attr_name"></span><label data-i18n-title="enter name" title="enter name"><input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{name}" type="text" value=""/></label></div></div><button class="chat" name="roll_name" type="roll" value="&{template:rolls} {{header=@{name}}} {{dice=@{notes}}}"><span class="pictos">q</span></button><div class="grid notes"><span class="display pl-4" name="attr_notes"></span><textarea name="attr_notes" placeholder="notes"></textarea></div></div></fieldset></div></div></div><div class="grid double-border-2 rounded-md abilities p-2"><h2 class="text-center" data-i18n="abilities list"></h2><fieldset class="repeating_abilities"><div class="grid descriptor relative gap-1"><input class="flag" name="attr_flag" title="edit flag" type="checkbox" value="true" checked="checked"/><span class="pictos">p</span><div class="grid grid-flow-col gap-4"><div class="grid col-auto-fr gap-2"><h3 data-i18n="name"></h3><span class="display" name="attr_name"></span><label data-i18n-title="enter name" title="enter name"><input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{name}" type="text" value=""/></label></div></div><button class="chat" name="roll_name" type="roll" value="&{template:rolls} {{header=@{name}}} {{dice=@{notes}}}"><span class="pictos">q</span></button><div class="grid notes"><span class="display pl-4" name="attr_notes"></span><textarea name="attr_notes" placeholder="notes"></textarea></div></div></fieldset></div></div></div><div class="footer"><span>Version  </span><span name="attr_version"></span><span>Original template created by Emerald Productions, LLC</span><img src="https://raw.githubusercontent.com/clevett/roll20-SheetTemplate/master/src/imgs/EProd_Emerald_Gloss.png" alt="Emerald Productions logo of an E"/></div><div class="rolltemplates"><rolltemplate class="sheet-rolltemplate-rolls"><div class="sheet-template-container"><!-- - Display a header on the template ---><div class="sheet-template-header">{{#header}}{{header}}{{/header}}</div><!-- - Display the dice roll in the template ---><div class="sheet-template-body">{{#dice}}<div class="sheet-template-row">{{dice}}</div>{{/dice}}<!-- - Display a description. This is great for text included with a roll --->{{#desc}}<div class="sheet-template-row"><span class="sheet-template-desc">{{desc}}</span></div>{{/desc}}</div></div></rolltemplate></div><script type="text/worker">const createAttributeName = (name: string) =>
  name?.replace(/ /g, "_").toLowerCase();
const findRepeatingFieldName = (trigger: string) => trigger.split("_")[1];
const getReprowAttributeName = (key: string) => {
  const reprowid = getReprowid(key);
  return key.split(`${reprowid}_`)[1];
};
const getReprowid = (trigger: string) => {
  const split = trigger.split("_");
  return `${split[0]}_${split[1]}_${split[2]}`;
};
const sumIntegers = (numbers: number[]) => numbers.reduce((a, b) => a + b, 0);
const versioningAttr = "latest_versioning_upgrade";

on("sheet:opened", () => {
  // setAttrs({ latest_versioning_upgrade: 3.2 }); //used for testing versioning
  getAttrs([versioningAttr], (v) => {
    versioning(parseFloat(v[versioningAttr]) || 1);
  });
});

const versionOneOne = () => {
  //placeholder for version 1.1
};

const versioning = async (version: number) => {
  const updateMessage = (v: number) =>
    console.log(
      `%c Sheet is updating to ${v}`,
      "color: orange; font-weight:bold"
    );

  switch (true) {
    case version < 1:
      versioning(1);
      updateMessage(1);
      break;
    case version < 1.1:
      updateMessage(1.1);
      versionOneOne();
      versioning(1.1);
      break;
    default:
      console.log(
        `%c Sheet is update to date.`,
        "color: green; font-weight:bold"
      );
      setAttrs({ version, [`${versioningAttr}`]: version });
  }
};
//Set variables, traits, and other attributes

// const attributes = [
//     "dexterity",
//     "strength",
//     "charisma",
// ]

// const skills = [
//   "awareness",,
//   "first aid",
//   "intrigue",
// ];

// const characteristics = {
//   movement: ["strength", "dexterity"],
// };
//Calculate a simple derived attribute
// characteristics.movement.forEach((attr: string) => {
//   on(`change:${attr}`, () => {
//     getAttrs(characteristics.movement, (values) => {
//       const {strength, dexterity} = values;
//       setAttrs({
//         movement: sumIntegers([strength, dexterity]) / 2,
//       });
//     });
//   });
// });

//Calculate all the values of a repeating section. Useful for calculating weights, totals, etc.
// on(`change:repeating_events:weight`, ({ triggerName }) => {
//   const repeatingRow = getReprowid(triggerName);

//   getSectionIDs("events", (idArray) => {
//     let rows = [];
//     idArray.forEach((id) =>
//       rows.push(`repeating_events_${id}_weight`)
//     );

//     getAttrs(rows, (values) => {
//       const parsedNums = parseIntegers(values);
//       const weightValues = Object.values(parsedNums);
//       const sum = sumIntegers(weightValues);

//       setAttrs({
//         weight_total: sum,
//         [`${repeatingRow}_total_weight`]: sum,
//       });
//     });
//   });
// });
</script>