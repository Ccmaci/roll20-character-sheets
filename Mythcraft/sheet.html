<input name="attr_version" type="hidden" value="1"/><input name="attr_latest_versioning_upgrade" type="hidden" value="1"/><input class="type" name="attr_sheet_type" type="hidden" value="character"/><input class="display_string" name="attr_character_settings" type="hidden" value=""/><div class="pc grid gap-8 p-2 w-full"><div class="flex flex-wrap flex-row gap-4"><div class="logo grow-0"><img src="images/logo.png"/></div><div class="grid gap-1 grow bio"><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="character name"></h2><label data-i18n-title="enter character name" title="enter character name"><input data-i18n-placeholder="character name" name="attr_character_name" placeholder="character name" title="@{character_name}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="lineage"></h2><label data-i18n-title="enter lineage" title="enter lineage"><input data-i18n-placeholder="lineage" name="attr_lineage" placeholder="lineage" title="@{lineage}" type="text" value=""/></label></div></div><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="level"></h2><label data-i18n-title="enter level" title="enter level"><input data-i18n-placeholder="level" name="attr_level" placeholder="level" title="@{level}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="height"></h2><label data-i18n-title="enter height" title="enter height"><input data-i18n-placeholder="height" name="attr_height" placeholder="height" title="@{height}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="weight"></h2><label data-i18n-title="enter weight" title="enter weight"><input data-i18n-placeholder="weight" name="attr_weight" placeholder="weight" title="@{weight}" type="text" value=""/></label></div></div><div class="grid grid-flow-col gap-1"><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="eye color"></h2><label data-i18n-title="enter eye color" title="enter eye color"><input data-i18n-placeholder="eye color" name="attr_eye_color" placeholder="eye color" title="@{eye_color}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="hair color"></h2><label data-i18n-title="enter hair color" title="enter hair color"><input data-i18n-placeholder="hair color" name="attr_hair_color" placeholder="hair color" title="@{hair_color}" type="text" value=""/></label></div><div class="grid col-auto-fr gap-1 grid-flow-col items-center"><h2 data-i18n="other"></h2><label data-i18n-title="enter other" title="enter other"><input data-i18n-placeholder="other" name="attr_other" placeholder="other" title="@{other}" type="text" value=""/></label></div></div></div></div><div class="div"><h2 class="text-center" data-i18n="personality / background"></h2><textarea name="attr_personality_background" placeholder="personality background"></textarea></div><div class="flex flex-wrap flex-row gap-4"><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="str"></h3><label data-i18n-title="enter str" title="enter str"><input name="attr_str" title="@{str}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter str skills bonus" title="enter str skills bonus"><input name="attr_str_skills_bonus" title="@{str_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="dex"></h3><label data-i18n-title="enter dex" title="enter dex"><input name="attr_dex" title="@{dex}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter dex skills bonus" title="enter dex skills bonus"><input name="attr_dex_skills_bonus" title="@{dex_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="end"></h3><label data-i18n-title="enter end" title="enter end"><input name="attr_end" title="@{end}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter end skills bonus" title="enter end skills bonus"><input name="attr_end_skills_bonus" title="@{end_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="luck"></h3><label data-i18n-title="enter luck" title="enter luck"><input name="attr_luck" title="@{luck}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter luck skills bonus" title="enter luck skills bonus"><input name="attr_luck_skills_bonus" title="@{luck_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="awr"></h3><label data-i18n-title="enter awr" title="enter awr"><input name="attr_awr" title="@{awr}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter awr skills bonus" title="enter awr skills bonus"><input name="attr_awr_skills_bonus" title="@{awr_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="int"></h3><label data-i18n-title="enter int" title="enter int"><input name="attr_int" title="@{int}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter int skills bonus" title="enter int skills bonus"><input name="attr_int_skills_bonus" title="@{int_skills_bonus}" type="number" value=""/></label></div></div><div class="grid"><div class="circle rounded-full border"><h3 data-i18n="cha"></h3><label data-i18n-title="enter cha" title="enter cha"><input name="attr_cha" title="@{cha}" type="number" value=""/></label></div><div class="box border"><h3 data-i18n="skills/bonus"></h3><label data-i18n-title="enter cha skills bonus" title="enter cha skills bonus"><input name="attr_cha_skills_bonus" title="@{cha_skills_bonus}" type="number" value=""/></label></div></div></div></div><div class="footer"><span>Version  </span><span name="attr_version"></span><span>Original template created by Emerald Productions, LLC</span><img src="https://raw.githubusercontent.com/clevett/roll20-SheetTemplate/master/src/imgs/EProd_Emerald_Gloss.png" alt="Emerald Productions logo of an E"/></div><div class="rolltemplates"><rolltemplate class="sheet-rolltemplate-rolls"><div class="sheet-template-container"><!-- - Display a header on the template ---><div class="sheet-template-header">{{#header}}{{header}}{{/header}}</div><!-- - Display the dice roll in the template ---><div class="sheet-template-body">{{#dice}}<div class="sheet-template-row">{{dice}}</div>{{/dice}}<!-- - Display a description. This is great for text included with a roll --->{{#desc}}<div class="sheet-template-row"><span class="sheet-template-desc">{{desc}}</span></div>{{/desc}}</div></div></rolltemplate></div><script type="text/worker">const createAttributeName = (name: string) =>
  name?.replace(/ /g, "_").toLowerCase();
const findRepeatingFieldName = (trigger: string) => trigger.split("_")[1];
const getReprowAttributeName = (key: string) => {
  const reprowid = getReprowid(key);
  return key.split(`${reprowid}_`)[1];
};
const getReprowid = (trigger: string) => {
  const split = trigger.split("_");
  return `${split[0]}_${split[1]}_${split[2]}`;
};
const sumIntegers = (numbers: number[]) => numbers.reduce((a, b) => a + b, 0);
const versioningAttr = "latest_versioning_upgrade";

on("sheet:opened", () => {
  // setAttrs({ latest_versioning_upgrade: 3.2 }); //used for testing versioning
  getAttrs([versioningAttr], (v) => {
    versioning(parseFloat(v[versioningAttr]) || 1);
  });
});

const versionOneOne = () => {
  //placeholder for version 1.1
};

const versioning = async (version: number) => {
  const updateMessage = (v: number) =>
    console.log(
      `%c Sheet is updating to ${v}`,
      "color: orange; font-weight:bold"
    );

  switch (true) {
    case version < 1:
      versioning(1);
      updateMessage(1);
      break;
    case version < 1.1:
      updateMessage(1.1);
      versionOneOne();
      versioning(1.1);
      break;
    default:
      console.log(
        `%c Sheet is update to date.`,
        "color: green; font-weight:bold"
      );
      setAttrs({ version, [`${versioningAttr}`]: version });
  }
};
//Set variables, traits, and other attributes

// const attributes = [
//     "dexterity",
//     "strength",
//     "charisma",
// ]

// const skills = [
//   "awareness",,
//   "first aid",
//   "intrigue",
// ];

// const characteristics = {
//   movement: ["strength", "dexterity"],
// };
//Calculate a simple derived attribute
// characteristics.movement.forEach((attr: string) => {
//   on(`change:${attr}`, () => {
//     getAttrs(characteristics.movement, (values) => {
//       const {strength, dexterity} = values;
//       setAttrs({
//         movement: sumIntegers([strength, dexterity]) / 2,
//       });
//     });
//   });
// });

//Calculate all the values of a repeating section. Useful for calculating weights, totals, etc.
// on(`change:repeating_events:weight`, ({ triggerName }) => {
//   const repeatingRow = getReprowid(triggerName);

//   getSectionIDs("events", (idArray) => {
//     let rows = [];
//     idArray.forEach((id) =>
//       rows.push(`repeating_events_${id}_weight`)
//     );

//     getAttrs(rows, (values) => {
//       const parsedNums = parseIntegers(values);
//       const weightValues = Object.values(parsedNums);
//       const sum = sumIntegers(weightValues);

//       setAttrs({
//         weight_total: sum,
//         [`${repeatingRow}_total_weight`]: sum,
//       });
//     });
//   });
// });
</script>