<input type="text" class="hidden" name="attr_sheet_version" value="0" title="@{sheet_version}" />
<div class='main'>
    <div class='logo-text'>
        <div class='logo-text-first-line'>
            TOP
        </div>
        <div class='logo-text-second-line'>
            SECRET
        </div>
    </div>
    <div class='page-title'>AGENT'S DOSSIER</div>
    <div class="two-column-grid">
        <div class="span-2">
            <label>CHARACTER NAME <input type="text" class="name-field" name="attr_character_name" value="" title="@{character_name}"></label>
            <!-- deprecated attribute -->
            <input type="text" class="hidden" name="attr_CharacterName">
        </div>
        <div class="span-2">
            <span class="general-column-header nowrap">Alias <input type="text" name="attr_Alias" title="@{Alias}"></span>
            <span class="general-column-header nowrap">Code Name <input type="text" name="attr_CodeName" title="@{CodeName}"></span>
        </div>
    </div>
    <nav>
        <input type="radio" name="attr_tab" class="tab tab1" value="1" title="Traits" checked="checked" /><span></span>
        <input type="radio" name="attr_tab" class="tab tab2" value="2" title="Stats" /><span></span>
        <input type="radio" name="attr_tab" class="tab tab3" value="3" title="Equipment" /><span></span>
        <input type="radio" name="attr_tab" class="tab tab4" value="4" title="Knowledge" /><span></span>
        <input type="radio" name="attr_tab" class="tab tab5" value="5" title="People" /><span></span>
        <input type="radio" name="attr_tab" class="tab tab6" value="6" title="Misc" /><span></span>
    </nav>

    <div class='tab-content tab1'>
        <div class='three-column-fit'>
            <div class='traits-column'>
                <div class='section-title'>PRIMARY PERSONAL TRAITS</div>
                <div class='instruction'>(If die roll is 01-25, add 25; 26-50, add 15; 51-70, add 10; 71-90, add 5)</div>
                <div class='two-column-grid'>
                    <label>Physical Strength</label>
                    <input type='text' name='attr_PhysicalStrength' title="@{PhysicalStrength}" class='trait-box'/>

                    <label>Charm</label>
                    <input type='text' name='attr_Charm' title="@{Charm}" class='trait-box'/>

                    <label>Willpower</label>
                    <input type='text' name='attr_Willpower' title="@{Willpower}" class='trait-box'/>

                    <label>Courage</label>
                    <input type='text' name='attr_Courage' title="@{Courage}" class='trait-box'/>

                    <label>Knowledge</label>
                    <input type='text' name='attr_Knowledge' title="@{Knowledge}" class='trait-box'/>

                    <label>Coordination</label>
                    <input type='text' name='attr_Coordination' title="@{Coordination}" class='trait-box'/>
                </div>
            </div>
            <div class='traits-column'>
                <div class='section-title'>SECONDARY PERSONAL TRAITS</div>
                <div class='two-column-grid'>
                    <label>Offense</label>
                    <input type='text' name='attr_Offense' class='trait-box' title="@{Offense} | round((@{Coordination} + @{Courage})/2)" value="0" readonly/>

                    <label>Deception</label>
                    <input type='text' name='attr_Deception' class='trait-box' title="@{Deception} | round((@{Charm} + @{Courage})/2)" value="0" readonly/>

                    <label>Evasion</label>
                    <input type='text' name='attr_Evasion' class='trait-box' title="@{Evasion} | round((@{Coordination} + @{Charm})/2)" value="0" readonly/>

                    <label>Deactivation</label>
                    <input type='text' name='attr_Deactivation' class='trait-box' title="@{Deactivation} | round((@{Coordination} + @{Knowledge})/2)" value="0" readonly/>

                    <label>Movement Value</label>
                    <input type='text' name='attr_MovementValue' class='trait-box' title="@{MovementValue} | @{Coordination} + @{PhysicalStrength} + @{Willpower}" value="0" readonly/>

                    <label>Life Level</label>
                    <span>
                        <input type='text' name='attr_LifeLevel' class='trait-box' title="@{LifeLevel}" value="0" />
                        <span class="division">/</span>
                        <input type='text' name='attr_LifeLevel_max' class='trait-box' title="@{LifeLevel_max} | round((@{PhysicalStrength} + @{Willpower})/10)" value="0" readonly/>
                    </span>
                    <!-- deprecated attribute -->
                    <input type='text' name='attr_CurrentLifeLevel' class='hidden' value="0" />
                </div>
            </div>
            <div class='traits-column'>
                <div class='section-title'>TERTIARY PERSONAL TRAITS</div>
                <div class='two-column-grid'>
                    <label>Hand-to-hand Combat Value</label>
                    <input type='text' name='attr_HandToHandCombatValue' class='trait-box' title="@{HandToHandCombatValue} | @{PhysicalStrength} + @{Evasion}" value="0" readonly/>

                    <label>Wrestling Value</label>
                    <input type='text' name='attr_WrestlingValue' class='trait-box' title="@{WrestlingValue} | @{PhysicalStrength} + @{Offense}" value="0" readonly/>

                    <label>Surprise Value</label>
                    <input type='text' name='attr_SurpriseValue' class='trait-box' title="@{SurpriseValue} | @{Deception} + @{Evasion}" value="0" readonly/>
                </div>
            </div>
        </div>
    </div>

    <div class='tab-content tab2'>
        <div>
            <div class='section-title'>VITAL STATISTICS</div>
            <div class="flex-row">
                <label>
                    <span class="right-aligned">Height</span>
                    <input type="text" class="height-column" name="attr_Height" title="@{Height}">
                </label>
                <label>
                    <span class="right-aligned">Weight</span>
                    <input type="text" class="weight-column" name="attr_Weight" title="@{Weight}">
                </label>
                <label>
                    <span class="right-aligned">Age</span>
                    <input type="text" class="age-column" name="attr_Age" title="@{Age}">
                </label>
                <label>
                    <span class="right-aligned">Sex</span>
                    <input type="text" class="sex-column" name="attr_Sex" title="@{Sex}">
                </label>
                <label>
                    <span class="right-aligned">National Origin</span>
                    <input type="text" name="attr_NationalOrigin" title="@{NationalOrigin}">
                </label>
            </div>
            <div class='flex-row'>
                <label>
                    <span class='right-aligned'>Handedness</span>
                    <input type='text' class='handedness-field' name='attr_Handedness' title="@{Handedness}"/>
                </label>
                <label>
                    <span class='right-aligned'>Race</span>
                    <input type='text' name='attr_Race' title="@{Race}"/>
                </label>
                <label>
                    <span class='right-aligned'>Glasses</span>
                    <input type='checkbox' name='attr_Glasses' title="@{Glasses}"/>
                </label>
                <label>
                    <span class='right-aligned'>Contacts</span>
                    <input type='checkbox' name='attr_Contacts' title="@{Contacts}"/>
                </label>
            </div>
            <div class='two-column-grid'>
                <label>Languages Known</label>
                <label>Fluency</label>
                <label class="nowrap">
                    <input type='text' class='languages-known-field' name='attr_NativeLanguage' title="@{NativeLanguage}">(Native)</input>
                </label>
                <input type='text' class='language-fluency-field' name='attr_NativeLanguageFluency' title="@{NativeLanguageFluency}"/>
            </div>
            <fieldset class="repeating_Languages">
                <div class='two-column-grid'>
                        <input type='text' class='languages-known-field' name='attr_Language' title="@{Language}"/>
                        <input type='text' class='language-fluency-field' name='attr_LanguageFluency' title="@{LanguageFluency}"/>
                </div>
            </fieldset>
        </div>
        <div>
            <div class='section-title'>CLASSIFIED INFORMATION</div>
            <label>Bureau <input type='text' name='attr_Bureau' title="@{Bureau}"/></label>
            <label>Total Experience Points <input type='text' name='attr_TotalExp' title="@{TotalExp}"/></label>
            <label>Level <input type='text' name='attr_Level' title="@{Level}"/></label>
            <label>Fame Points <input type='text' name='attr_FamePoints' title="@{FamePoints}"/></label>
            <label>Fortune Points <input type='text' name='attr_FortunePoints' title="@{FortunePoints}"/></label>
            <label>Experience Points Used <input type='text' name='attr_ExpUsed' title="@{ExpUsed}"/></label>
            <label>Unused Experience Points <input type='text' name='attr_UnusedExp' title="@{UnusedExp}"/></label>
        </div>
    </div>

    <div class='tab-content tab3'>
        <div>
            <div class='section-title'>WEAPONS</div>

            <div class="hit-determination-grid">
                <div class="span-all">
                    <span>
                        <span class="general-column-header">HIT DETERMINATION</span>
                        <span class="instruction">(Applies to all weapon rolls.)</span>
                    </span>
                    <div style="float: right;">
                        <button type="action" class="btn reset-image" name="act_hitDetResetAll" title="Reset all Hit Determination modifiers.">
                            <span style="margin-right: 5px;">Reset All</span>
                        </button>
                    </div>
                </div>
                <!-- movement of shooter -->
                <span>
                    <span class="general-column-header">Movement of Shooter</span>
                    <input type="text" name="attr_hit_det_move_of_shooter_total" value="0" title="@{hit_det_move_of_shooter_total}" readonly/>
                    <button type="action" class="btn reset-image" name="act_hitDetResetMovementOfShooter" title="Reset Movement of Shooter modifiers."></button>
                    <select name="attr_hit_det_move_of_shooter" title="@{hit_det_move_of_shooter}">
                        <option value="0" selected>Stationary 0</option>
                        <option value="1">Stationary and prone +5</option>
                        <option value="2">Walking -5</option>
                        <option value="3">Wading -10</option>
                        <option value="4">Crawling -10</option>
                        <option value="5">Running and dodging -30</option>
                        <option value="6">Running -20</option>
                        <option class="show-mph" value="7">Vehicular Movement -10</option>
                        <option value="8">Drops Prone -20</option>
                    </select>
                    <label class="mph">
                        <span class="general-column-header">Speed of Shooter</span>
                        <input type="text" name="attr_hit_det_shooter_speed_multiplier" class="trait-box" value="0" title="@{hit_det_shooter_speed_multiplier}" />
                        <span>MPH</span>
                    </label>
                </span>
                <!-- movement of target -->
                <span>
                    <span class="general-column-header">Movement of Target</span>
                    <input type="text" name="attr_hit_det_move_of_target_total" value="0" title="@{hit_det_move_of_target_total}" readonly />
                    <button type="action" class="btn reset-image" name="act_hitDetResetMovementOfTarget" title="Reset Movement of Target modifiers."></button>
                    <select name="attr_hit_det_move_of_target" title="@{hit_det_move_of_target}">
                        <option value="0" selected>Stationary 0</option>
                        <option value="1">Walking -5</option>
                        <option value="2">Wading -5</option>
                        <option value="3">Crawling -5</option>
                        <option value="4">Running -10</option>
                        <option value="5">Running and dodging -20</option>
                        <option value="6" class="show-mph">Vehicular Movement -10</option>
                        <option value="7">Drops Prone -5</option>
                    </select>
                    <label class="mph">
                        <span class="general-column-header">Speed of Target</span>
                        <input type="text" name="attr_hit_det_target_speed_multiplier" class="trait-box" value="0" title="@{hit_det_target_speed_multiplier}" />
                        <span>MPH</span>
                    </label>
                </span>
                <!-- wounds -->
                <span>
                    <span class="general-column-header">Wounds</span>
                    <input type="text" name="attr_hit_det_wounds_total" value="0" title="@{hit_det_wounds_total}" readonly />
                    <button type="action" class="btn reset-image" name="act_hitDetResetWounds" title="Reset Wounds modifiers."></button>
                    <select name="attr_hit_det_wounds" title="@{hit_det_wounds}">
                        <option value="0" selected>Character firing is not wounded 0</option>
                        <option value="-5">Character firing is wounded, but Life Level is more than ½ normal -5</option>
                        <option value="-20">Character firing is wounded and Life Level is ½ or below -20</option>
                    </select>
                </span>

                <span></span>
                <!-- misc. -->
                <details class="hit-determination-misc span-all">
                    <summary>
                        <span class="general-column-header">Miscellaneous</span>
                        <input type="text" name="attr_hit_det_misc_total" value="0" title="@{hit_det_misc_total}" readonly />
                        <button type="action" class="btn reset-image" name="act_hitDetResetMisc" title="Reset Misc. modifiers."></button>
                    </summary>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_weapon_at_rest" value="10" title="@{hit_det_misc_weapon_at_rest}" />
                            <span>Weapon at rest on solid object (not possible the phase weapon is first aimed at target) +10</span>
                        </span>
                    </label>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_2nd_consecutive" value="-10" title="@{hit_det_misc_2nd_consecutive}" />
                            <span>Second consecutive shot by one character<strong>*</strong> -10</span>
                        </span>
                    </label>
                    <div>
                        <span>
                            <label>
                                <input type="checkbox" name="attr_hit_det_misc_additional_consecutive" value="-10" title="@{hit_det_misc_additional_consecutive}" />
                                <span>Each additional consecutive shot -10 per shot by one character<strong>*</strong> (cumulative)</span>
                            </label>
                            <span>Which Shot?</span><input type="text" class="trait-box" name="attr_hit_det_misc_additional_consecutive_multiplier" value="1" title="@{hit_det_misc_additional_consecutive_multiplier}" />
                        </span>
                    </div>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_wrong_hand" value="-10" title="@{hit_det_misc_wrong_hand}" />
                            <span>Shooting with the wrong hand (with left hand if right-handed, etc.) -10</span>
                        </span>
                    </label>
                    <div>
                        <span>
                            <label>
                                <input type="checkbox" name="attr_hit_det_misc_wounded_gun_hand" value="-5" title="@{hit_det_misc_wounded_gun_hand}" />
                                <span>Shooter wounded in gun arm/hand -5 per injury point</span>
                            </label>
                            <span>Injury Points?</span>
                            <input type="text" class="trait-box" name="attr_hit_det_misc_wounded_gun_hand_multiplier" value="1" title="@{hit_det_misc_wounded_gun_hand_multiplier}" />
                        </span>
                    </div>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_two_weapons" value="-30" title="@{hit_det_misc_two_weapons}" />
                            <span>Firing two weapons -30</span>
                        </span>
                    </label>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_hip_shooting" value="-10" title="@{hit_det_misc_hip_shooting}" />
                            <span>Hipshooting -10</span>
                        </span>
                    </label>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_obscured" value="-10" title="@{hit_det_misc_obscured}" />
                            <span>Target obscured (50% or less of target is visible or prone) -10</span>
                        </span>
                    </label>
                    <label>
                        <span>
                            <input type="checkbox" name="attr_hit_det_misc_gyrojet" value="10" title="@{hit_det_misc_gyrojet}" />
                            <span>Using gyrojet ammunition +10</span>
                        </span>
                    </label>
                    <span class="instruction"><strong>*</strong>Note that if at any point a character takes a "steadying phase”, all consecutive shot penalties revert back to zero.</span>
                </details>

                <span></span>
                <!-- automatic weapons -->
                <div class="hit-determination-automatic-grid span-2">
                    <div class="span-all nowrap">
                        <span class="general-column-header">Automatic Weapons</span>
                        <input type="text" name="attr_hit_det_automatic_total" class="larger" value="0" title="@{hit_det_automatic_total}" readonly />
                        <button type="action" class="btn reset-image" name="act_hitDetResetAutomaticWeapons" title="Reset Automatic Weapons. modifiers."></button>
                    </div>

                    <span>Shot#</span>
                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10+</span>

                    <span>Auto</span>
                    <input type="radio" name="attr_hit_det_automatic" value="0" title="0" checked />
                    <input type="radio" name="attr_hit_det_automatic" value="-11" title="-11" />
                    <input type="radio" name="attr_hit_det_automatic" value="-22" title="-22" />
                    <input type="radio" name="attr_hit_det_automatic" value="-33" title="-33" />
                    <input type="radio" name="attr_hit_det_automatic" value="-46" title="-46" />
                    <input type="radio" name="attr_hit_det_automatic" value="-63" title="-63" />
                    <input type="radio" name="attr_hit_det_automatic" value="-85" title="-85" />
                    <input type="radio" name="attr_hit_det_automatic" value="-100" title="-100" />
                    <input type="radio" name="attr_hit_det_automatic" value="-150" title="-150" />
                    <input type="radio" name="attr_hit_det_automatic" value="-200" title="-200" />

                    <span>Semi</span>
                    <input type="radio" name="attr_hit_det_automatic" value="0 " title="0" checked />
                    <input type="radio" name="attr_hit_det_automatic" value="-11 " title="-11" />
                    <input type="radio" name="attr_hit_det_automatic" value="-21" title="-21" />
                    <input type="radio" name="attr_hit_det_automatic" value="-32" title="-32" />
                    <input type="radio" name="attr_hit_det_automatic" value="-44" title="-44" />
                    <input type="radio" name="attr_hit_det_automatic" value="-57" title="-57" />
                    <input type="radio" name="attr_hit_det_automatic" value="-73" title="-73" />
                    <input type="radio" name="attr_hit_det_automatic" value="-96" title="-96" />
                    <input type="radio" name="attr_hit_det_automatic" value="-130" title="-130" />
                    <input type="radio" name="attr_hit_det_automatic" value="-180" title="-180" />
                </div>
                <div class="span-all">
                    <span style="float: right;margin-top: -2.25em;">
                        <span class="general-column-header" title="Does not include range modifiers.">TOTAL</span>
                        <input type="text" name="attr_hit_det_total" class="larger" value="0" title="@{hit_det_total}" readonly="">
                    </span>
                </div>
            </div>
            <div class='weapons-grid'>
                <span></span>
                <span></span>
                <span></span>
                <span class='weapon-range-modifier-column'>Range Modifier</span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>

                <span></span>
                <span class='weapon-column'>WEAPON</span>
                <span class='weapon-pwv-column'>PWV</span>

                <span class='weapon-range-modifier-subcolumn'>PB</span>
                <span class='weapon-range-modifier-subcolumn'>S</span>
                <span class='weapon-range-modifier-subcolumn'>M</span>
                <span class='weapon-range-modifier-subcolumn'>L</span>

                <span class='weapon-speed-column'>WS</span>
                <span class='weapon-rate-column'>Rate</span>
                <span class='weapon-rate-column'>Ammo</span>
                <span class='weapon-base-speed-column'>BASE SPEED</span>
                <span class='weapon-base-accuracy-column'>BASE ACCURACY</span>
                <span>HIT DET</span>
            </div>
            <fieldset class="repeating_Weapons">
                <div class='weapons-grid'>
                    <button type="roll" name="roll_attack" value="@{attack}" title="%{repeating_Weapons_$X_attack}"></button>
                    <button type="action" class="hidden" name="act_attack-button"></button>
                    <input type="text" class="hidden" name="attr_attack" value="" />

                    <input type='text' class='weapon-column' name='attr_Weapon' title="@{repeating_Weapons_$X_Weapon}"/>
                    <input type='text' class='weapon-pwv-column' name='attr_PWV' value="0" title="@{repeating_Weapons_$X_PWV}"/>
                    <input type='text' class='weapon-range-modifier-subcolumn' name='attr_RangeModifierPB' value='0' title="@{repeating_Weapons_$X_RangeModifierPB}" />
                    <input type='text' class='weapon-range-modifier-subcolumn' name='attr_RangeModifierS' value='0' title="@{repeating_Weapons_$X_RangeModifierS}" />
                    <input type='text' class='weapon-range-modifier-subcolumn' name='attr_RangeModifierM' value='0' title="@{repeating_Weapons_$X_RangeModifierM}" />
                    <input type='text' class='weapon-range-modifier-subcolumn larger' name='attr_RangeModifierL' value='0' title="@{repeating_Weapons_$X_RangeModifierL}" />
                    <select name='attr_WeaponSpeedModifier' title="@{repeating_Weapons_$X_WeaponSpeedModifier}" class='weapon-speed-column'>
                        <option value="-10" title="very slow">VS</option>
                        <option value="-5" title="slow">S</option>
                        <option value="-3" title="below average">BA</option>
                        <option value="0" title="average">A</option>
                        <option value="5" title="fast">F</option>
                        <option value="10" title="very fast">VF</option>
                    </select>
                    <input type='text' class='weapon-rate-column' name='attr_Rate' value='1' title="@{repeating_Weapons_$X_Rate}" />
                    <span>
                        <input type='text' class='trait-box' name='attr_ammo' value='0' title="@{repeating_Weapons_$X_ammo}" />
                        <span class="division">/</span>
                        <input type='text' class='trait-box' name='attr_ammo_max' value='0' title="@{repeating_Weapons_$X_ammo|max}" />
                    </span>
                    <input type='text' class='weapon-base-speed-column' name='attr_BaseSpeed' value='0' title="@{repeating_Weapons_$X_BaseSpeed | @{WeaponSpeedModifier} + @{Offense}}" readonly/>
                    <input type='text' class='weapon-base-accuracy-column' name='attr_BaseAccuracy' value='0' title="@{repeating_Weapons_$X_BaseAccuracy | @{PWV} + @{Offense}" readonly/>
                    <input type='text' class='weapon-pwv-column larger' name='attr_hit_det' value="0" title="@{repeating_Weapons_$X_hit_det}" readonly/>
                    <!--<input type='text' class='weapon-range-modifier-column' name='attr_RangeModifier' title="@{repeating_Weapons_$X_RangeModifier}"-->
                </div>
            </fieldset>
        </div>
        <div class="three-column-fit">
            <div>
                <div class='section-title'>EQUIPMENT CARRIED</div>
                <div class='two-column-grid'>
                    <div class='general-column-header'>
                        <span>ITEM</span>
                    </div>
                    <div class='general-column-header'>
                        <span>LOCATION</span>
                    </div>
                </div>
                <fieldset class="repeating_EquipmentCarried">
                    <div class='two-column-grid'>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Item' title="@{repeating_EquipmentCarried_$X_Item}"/>
                        </div>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Location' title="@{repeating_EquipmentCarried_$X_Location}"/>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div>
                <div class='section-title'>OTHER ITEMS CARRIED</div>
                <div class='two-column-grid'>
                    <div class='general-column-header'>
                        <span>ITEM</span>
                    </div>
                    <div class='general-column-header'>
                        <span>LOCATION</span>
                    </div>
                </div>
                <fieldset class="repeating_OtherItemsCarried">
                    <div class='two-column-grid'>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Item' title="@{repeating_OtherItemsCarried_$X_Item}"/>
                        </div>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Location' title="@{repeating_OtherItemsCarried_$X_Location}"/>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div>
                <div class='section-title'>MONEY & VALUABLES</div>
                <div class='two-column-grid'>
                    <div class='general-column-header'>
                        <span>AMOUNT OR ITEM</span>
                    </div>
                    <div class='general-column-header'>
                        <span>LOCATION</span>
                    </div>
                </div>
                <fieldset class="repeating_MoneyAndValuables">
                    <div class='two-column-grid'>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Item' title="@{repeating_MoneyAndValuables_$X_Item}"/>
                        </div>
                        <div>
                            <input type='text' class='full-width-element' name='attr_Location' title="@{repeating_MoneyAndValuables_$X_Location}"/>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>

    <div class='tab-content tab6'>
        <div class="three-column-fit">
            <div>
                <div class='section-title'>RESIDENCE</div>
                <textarea class='text-area residence-text-area' name='attr_Residence' title="@{Residence}"></textarea>
            </div>
            <div>
                <div class='section-title'>COVER</div>
                <textarea class='text-area cover-text-area' name='attr_Cover' title="@{Cover}"></textarea>
            </div>
            <div>
                <div class='section-title'>BRIEF PERSONAL HISTORY</div>
                <textarea class='text-area history-text-area' name='attr_BriefPersonalHistory' title="@{BriefPersonalHistory}"></textarea>
            </div>
            <div class='notes-col'>
                <div class='section-title'>NOTES</div>
                <textarea class='text-area notes-text-area' name='attr_Notes' title="@{Notes}"></textarea>
            </div>
        </div>
    </div>

    <div class='tab-content tab5'>
        <div class="three-column-fit">
            <div>
                <div class='section-title'>FRIENDS</div>
                <fieldset class="repeating_Friends">
                    <div>
                        <input type='text' class='full-width-element' name='attr_Name' title="@{repeating_Friends_$X_Name}"/>
                    </div>
                </fieldset>
            </div>
            <div>
                <div class='section-title'>CONTACTS</div>
                <fieldset class="repeating_Contacts">
                    <div>
                        <input type='text' class='full-width-element' name='attr_Name' title="@{repeating_Contacts_$X_Name}"/>
                    </div>
                </fieldset>
            </div>
            <div>
                <div class='section-title'>ENEMIES</div>
                <fieldset class="repeating_Enemies">
                    <div>
                        <input type='text' class='full-width-element' name='attr_Name' title="@{repeating_Enemies_$X_Name}"/>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>

    <div class='tab-content tab4'>
        <div class='section-title'>AREAS OF KNOWLEDGE</div>
        <div class='aok-grid'>
            <span class="span-2">
                <span>
                    <span class="general-column-header">#of AOK</span>
                    <input type='text' class='trait-box' name='attr_AreaOfKnowledgeKnown' title="@{AreaOfKnowledgeKnown} | round(@{Knowledge}/10)" value='0' readonly/>
                </span>
                <span>
                    <span class="general-column-header">Default</span>
                    <input type='text' class='trait-box' name='attr_AreaOfKnowledgeDefaultValue' title="@{AreaOfKnowledgeDefaultValue} | round(@{Knowledge}/2)" value='0' readonly/>
                </span>
            </span>
            <span class="general-column-header aok-col-1-heading">AOK</span>
            <span class="general-column-header">VALUE</span>
        </div>
        <fieldset class="repeating_AreasOfKnowledge">
            <div class='aok-grid'>
                <div class='aok-col-1'>
                    <select name='attr_AreasOfKnowledgeName' title="@{repeating_AreasOfKnowledge_$X_AreasOfKnowledgeName}">
                        <option>Agriculture</option>
                        <option>Animal Science</option>
                        <option>Architecture</option>
                        <option>Arts & Crafts</option>
                        <option>Astronomy/Space Science</option>
                        <option>Biology/Biochemistry</option>
                        <option>Botany</option>
                        <option>Chemistry</option>
                        <option>Computer Science</option>
                        <option>Ecology/Earth Sciences</option>
                        <option>Economics/Finance</option>
                        <option>Education/Indoctrination</option>
                        <option>Engineering, Aeronautical</option>
                        <option>Engineering, Construction/Civil</option>
                        <option>Engineering, Electrical</option>
                        <option>Engineering, Hydraulic</option>
                        <option>Engineering, Industrial</option>
                        <option>Engineering, Mechanical</option>
                        <option>Engineering, Transportation</option>
                        <option>Fine Arts</option>
                        <option>Geography</option>
                        <option>Geology</option>
                        <option>Home Economics</option>
                        <option>Law</option>
                        <option>Literature</option>
                        <option>Mathematics/Accounting</option>
                        <option>Medicine/Physiology</option>
                        <option>Metallurgy</option>
                        <option>Military Science/Weaponry</option>
                        <option>Photography</option>
                        <option>Physical Education</option>
                        <option>Physics</option>
                        <option>Political Science/Ideology</option>
                        <option>Psychology</option>
                        <option>Religion</option>
                        <option>Social Sciences</option>
                        <option>World History/Current Affairs</option>
                    </select>
                    <!-- deprecated attribute -->
                    <select class="hidden" name='attr_WeaponSpeedModifier' title="@{repeating_AreasOfKnowledge_$X_WeaponSpeedModifier}">
                        <option>Agriculture</option>
                        <option>Animal Science</option>
                        <option>Architecture</option>
                        <option>Arts & Crafts</option>
                        <option>Astronomy/Space Science</option>
                        <option>Biology/Biochemistry</option>
                        <option>Botany</option>
                        <option>Chemistry</option>
                        <option>Computer Science</option>
                        <option>Ecology/Earth Sciences</option>
                        <option>Economics/Finance</option>
                        <option>Education/Indoctrination</option>
                        <option>Engineering, Aeronautical</option>
                        <option>Engineering, Construction/Civil</option>
                        <option>Engineering, Electrical</option>
                        <option>Engineering, Hydraulic</option>
                        <option>Engineering, Industrial</option>
                        <option>Engineering, Mechanical</option>
                        <option>Engineering, Transportation</option>
                        <option>Fine Arts</option>
                        <option>Geography</option>
                        <option>Geology</option>
                        <option>Home Economics</option>
                        <option>Law</option>
                        <option>Literature</option>
                        <option>Mathematics/Accounting</option>
                        <option>Medicine/Physiology</option>
                        <option>Metallurgy</option>
                        <option>Military Science/Weaponry</option>
                        <option>Photography</option>
                        <option>Physical Education</option>
                        <option>Physics</option>
                        <option>Political Science/Ideology</option>
                        <option>Psychology</option>
                        <option>Religion</option>
                        <option>Social Sciences</option>
                        <option>World History/Current Affairs</option>
                    </select>
                </div>
                <div class='area-of-knowledge-value-column'>
                    <input type='text' class='trait-box' name='attr_AreaOfKnowledgeValue' title="@{repeating_AreasOfKnowledge_$X_AreaOfKnowledgeValue}"/>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-general"></rolltemplate>

<script type="text/worker">// move html calcs to sheetworkers
  // GLOBAL concatenates repeating attribute names
  // (repeating section, rowID, attribute)
  const section_attribute = (section, id, field) => `repeating_${section}_${id}_${field}`;
  // add version check to fix/migrate a couple attribute names
  // characterName s/b character_name
  // repeating_AreasOfKnowledge_$X_WeaponSpeedModifier s/b AreaOfKnowledgeName
  // added hit determination calcs
  // added weapon rolls

  // trait calcs
  on('change:physicalstrength change:charm change:willpower change:courage change:knowledge change:coordination', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getAttrs(['physicalstrength', 'charm', 'willpower', 'courage', 'knowledge', 'coordination'], (v) => {
      const output = {};
      const physicalstrength = +v.physicalstrength || 0;
      const charm = +v.charm || 0;
      const willpower = +v.willpower || 0;
      const courage = +v.courage || 0;
      const knowledge = +v.knowledge || 0;
      const coordination = +v.coordination || 0;
      // secondary calcs
      const offense = Math.round((courage + coordination) / 2);
      console.log(`Change detected: offense:${offense}`);
      output.offense = offense;
      const deception = Math.round((charm + courage) / 2);
      console.log(`Change detected: deception:${deception}`);
      output.deception = deception;
      const evasion = Math.round((coordination + charm) / 2);
      console.log(`Change detected: evasion:${evasion}`);
      output.evasion = evasion;
      const deactivation = Math.round((coordination + knowledge) / 2);
      console.log(`Change detected: deactivation:${deactivation}`);
      output.deactivation = deactivation;
      const movementvalue = coordination + physicalstrength + willpower;
      console.log(`Change detected: movementvalue:${movementvalue}`);
      output.movementvalue = movementvalue;
      const lifelevelMax = Math.round((physicalstrength + willpower) / 10);
      console.log(`Change detected: lifelevel_max:${lifelevelMax}`);
      output.lifelevel_max = lifelevelMax;
      // tertiary calcs
      const handtohandcombatvalue = physicalstrength + evasion;
      console.log(`Change detected: handtohandcombatvalue:${handtohandcombatvalue}`);
      output.handtohandcombatvalue = handtohandcombatvalue;
      const wrestlingvalue = physicalstrength + offense;
      console.log(`Change detected: wrestlingvalue:${wrestlingvalue}`);
      output.wrestlingvalue = wrestlingvalue;
      const surprisevalue = deception + evasion;
      console.log(`Change detected: surprisevalue:${surprisevalue}`);
      output.surprisevalue = surprisevalue;
      // AOK
      const AOKdefault = Math.round(knowledge / 2);
      console.log(`Change detected: AOKdefault:${AOKdefault}`);
      output.AreaOfKnowledgeDefaultValue = AOKdefault;
      const AOKknown = Math.round(knowledge / 10);
      console.log(`Change detected: AOKknown:${AOKknown}`);
      output.AreaOfKnowledgeKnown = AOKknown;
      setAttrs(output);
    });
  });

  // weapon calcs
  on('change:repeating_weapons', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    const id = eventInfo.sourceAttribute.split('_')[2];
    getAttrs(['offense', 'hit_det_total', `repeating_weapons_${id}_weaponspeedmodifier`, `repeating_weapons_${id}_pwv`], (v) => {
      const output = {};
      const offense = +v.offense || 0;
      const weaponSpeed = +v[`repeating_weapons_${id}_weaponspeedmodifier`] || 0;
      const PWV = +v[`repeating_weapons_${id}_pwv`] || 0;
      const hitDetTotal = v.hit_det_total || 0;
      output[`repeating_weapons_${id}_basespeed`] = offense + weaponSpeed;
      output[`repeating_weapons_${id}_baseaccuracy`] = offense + PWV;
      output[`repeating_weapons_${id}_hit_det`] = hitDetTotal;
      setAttrs(output, {silent: true});
    });
  });

  on('change:offense', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getSectionIDs('repeating_weapons', (idArray) => {
      const output = {};
      const fields = ['offense'];
      _.each(idArray, (id) => {
        fields.push(section_attribute('weapons', id, 'weaponspeedmodifier'));
        fields.push(section_attribute('weapons', id, 'pwv'));
      });
      getAttrs(fields, (v) => {
        idArray.forEach((id) => {
          const offense = +v.offense || 0;
          const weaponSpeed = +v[section_attribute('weapons', id, 'weaponspeedmodifier')];
          const PWV = +v[section_attribute('weapons', id, 'pwv')];
          output[section_attribute('weapons', id, 'basespeed')] = offense + weaponSpeed;
          output[section_attribute('weapons', id, 'baseaccuracy')] = offense + PWV;
        });
        setAttrs(output, {silent: true});
      });
    });
  });

  // hit determination chart

  // movement of shooter
  on('change:hit_det_move_of_shooter change:hit_det_shooter_speed_multiplier clicked:hitDetResetAll clicked:hitDetResetMovementOfShooter', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getAttrs(['hit_det_move_of_shooter', 'hit_det_shooter_speed_multiplier'], (v) => {
      const output = {};
      let actionButton = eventInfo.triggerName;
      actionButton = actionButton.replace('clicked:', '');
      if (actionButton !== 'hitdetresetmovementofshooter' && actionButton !== 'hitdetresetall') {
        let moveShooter = +v['hit_det_move_of_shooter'] || 0;
        let speedMult = 0;
        if (moveShooter === 7) {
          speedMult = +Math.max(0, v['hit_det_shooter_speed_multiplier'] || 0);
        }
        const moveShooterValues = {
          0: 0, // Stationary
          1: 5, // Stationary and prone
          2: -5, // Walking
          3: -10, // Wading
          4: -10, // Crawling
          5: -30, // Running and dodging
          6: -20, // Running
          7: -10, // Vehicular Movement
          8: -20, // Drops Prone
        };
        moveShooter = moveShooterValues[moveShooter] || 0;
        output.hit_det_move_of_shooter_total = moveShooter - speedMult;
        output.hit_det_shooter_speed_multiplier = speedMult;
      } else {
        console.log(`Change detected: Reset`);
        output.hit_det_move_of_shooter_total = 0;
        output.hit_det_move_of_shooter = 0;
        output.hit_det_shooter_speed_multiplier = 0;
      }
      setAttrs(output);
    });
  });

  // movement of target
  on('change:hit_det_move_of_target change:hit_det_target_speed_multiplier clicked:hitDetResetAll clicked:hitDetResetMovementOfTarget', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getAttrs(['hit_det_move_of_target', 'hit_det_target_speed_multiplier'], (v) => {
      const output = {};
      let actionButton = eventInfo.triggerName;
      actionButton = actionButton.replace('clicked:', '');
      if (actionButton !== 'hitdetresetmovementoftarget' && actionButton !== 'hitdetresetall') {
        let moveTarget = +v['hit_det_move_of_target'] || 0;
        let speedMult = 0;
        if (moveTarget === 6) {
          speedMult = +Math.max(0, v['hit_det_target_speed_multiplier'] || 0);
        }
        const moveTargetValues = {
          0: 0, // Stationary
          1: -5, // Walking
          2: -5, // Wading
          3: -5, // Crawling
          4: -10, // Running
          5: -20, // Running and dodging
          6: -10, // Vehicular Movement
          7: -5, // Drops Prone
        };
        moveTarget = moveTargetValues[moveTarget] || 0;
        output.hit_det_move_of_target_total = moveTarget - speedMult;
        output.hit_det_target_speed_multiplier = speedMult;
      } else {
        console.log(`Change detected: Reset`);
        output.hit_det_move_of_target_total = 0;
        output.hit_det_move_of_target = 0;
        output.hit_det_target_speed_multiplier = 0;
      }
      setAttrs(output);
    });
  });

  // wounds
  on('change:hit_det_wounds clicked:hitDetResetAll clicked:hitDetResetWounds', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getAttrs(['hit_det_wounds'], (v) => {
      const output = {};
      let actionButton = eventInfo.triggerName;
      actionButton = actionButton.replace('clicked:', '');
      if (actionButton !== 'hitdetresetwounds' && actionButton !== 'hitdetresetall') {
        const valWounds = +v['hit_det_wounds'] || 0;
        output.hit_det_wounds_total = valWounds;
      } else {
        console.log(`Change detected: Reset`);
        output.hit_det_wounds_total = 0;
        output.hit_det_wounds = 0;
      }
      setAttrs(output);
    });
  });

  // miscellaneous
  on(
    'change:hit_det_misc_weapon_at_rest change:hit_det_misc_2nd_consecutive change:hit_det_misc_additional_consecutive change:hit_det_misc_additional_consecutive_multiplier change:hit_det_misc_wrong_hand change:hit_det_misc_wounded_gun_hand change:hit_det_misc_wounded_gun_hand_multiplier change:hit_det_misc_two_weapons change:hit_det_misc_hip_shooting change:hit_det_misc_obscured change:hit_det_misc_gyrojet change:hit_det_misc_total clicked:hitDetResetAll clicked:hitDetResetMisc',
    (eventInfo) => {
      console.log(`Change detected: ${eventInfo.sourceAttribute}`);
      getAttrs(
        [
          'hit_det_misc_weapon_at_rest',
          'hit_det_misc_2nd_consecutive',
          'hit_det_misc_additional_consecutive',
          'hit_det_misc_additional_consecutive_multiplier',
          'hit_det_misc_wrong_hand',
          'hit_det_misc_wounded_gun_hand',
          'hit_det_misc_wounded_gun_hand_multiplier',
          'hit_det_misc_two_weapons',
          'hit_det_misc_hip_shooting',
          'hit_det_misc_obscured',
          'hit_det_misc_gyrojet',
          'hit_det_misc_total',
        ],
        (v) => {
          const output = {};
          let actionButton = eventInfo.triggerName;
          actionButton = actionButton.replace('clicked:', '');
          if (actionButton !== 'hitdetresetmisc' && actionButton !== 'hitdetresetall') {
            const valWeapon_at_rest = +v.hit_det_misc_weapon_at_rest || 0;
            const val2nd_consecutive = +v.hit_det_misc_2nd_consecutive || 0;
            const valAdditional_consecutive = +v.hit_det_misc_additional_consecutive || 0;
            const valAdditional_consecutive_multiplier = +v.hit_det_misc_additional_consecutive_multiplier || 0;
            const valWrong_hand = +v.hit_det_misc_wrong_hand || 0;
            const valWounded_gun_hand = +v.hit_det_misc_wounded_gun_hand || 0;
            const valWounded_gun_hand_multiplier = +v.hit_det_misc_wounded_gun_hand_multiplier || 0;
            const valTwo_weapons = +v.hit_det_misc_two_weapons || 0;
            const valHip_shooting = +v.hit_det_misc_hip_shooting || 0;
            const valObscured = +v.hit_det_misc_obscured || 0;
            const valGyrojet = +v.hit_det_misc_gyrojet || 0;

            output.hit_det_misc_weapon_at_rest = valWeapon_at_rest;
            output.hit_det_misc_2nd_consecutive = val2nd_consecutive;
            output.hit_det_misc_additional_consecutive = valAdditional_consecutive;
            output.hit_det_misc_additional_consecutive_multiplier = valAdditional_consecutive_multiplier;
            output.hit_det_misc_wrong_hand = valWrong_hand;
            output.hit_det_misc_wounded_gun_hand = valWounded_gun_hand;
            output.hit_det_misc_wounded_gun_hand_multiplier = valWounded_gun_hand_multiplier;
            output.hit_det_misc_two_weapons = valTwo_weapons;
            output.hit_det_misc_hip_shooting = valHip_shooting;
            output.hit_det_misc_obscured = valObscured;
            output.hit_det_misc_gyrojet = valGyrojet;
            output.hit_det_misc_total =
              valWeapon_at_rest +
              val2nd_consecutive +
              valAdditional_consecutive * valAdditional_consecutive_multiplier +
              valWrong_hand +
              valWounded_gun_hand * valWounded_gun_hand_multiplier +
              valTwo_weapons +
              valHip_shooting +
              valObscured +
              valGyrojet;
          } else {
            console.log(`Change detected: Reset`);
            output.hit_det_misc_weapon_at_rest = 0;
            output.hit_det_misc_2nd_consecutive = 0;
            output.hit_det_misc_additional_consecutive = 0;
            output.hit_det_misc_additional_consecutive_multiplier = 1;
            output.hit_det_misc_wrong_hand = 0;
            output.hit_det_misc_wounded_gun_hand = 0;
            output.hit_det_misc_wounded_gun_hand_multiplier = 1;
            output.hit_det_misc_two_weapons = 0;
            output.hit_det_misc_hip_shooting = 0;
            output.hit_det_misc_obscured = 0;
            output.hit_det_misc_gyrojet = 0;
            output.hit_det_misc_total = 0;
          }
          setAttrs(output);
        },
      );
    },
  );

  // automatic weapons
  on('change:hit_det_automatic clicked:hitDetResetAll clicked:hitDetResetAutomaticWeapons', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getAttrs(['hit_det_automatic'], (v) => {
      const output = {};
      let actionButton = eventInfo.triggerName;
      actionButton = actionButton.replace('clicked:', '');
      if (actionButton !== 'hitdetresetautomaticweapons' && actionButton !== 'hitdetresetall') {
        const valAutomatic = +v['hit_det_automatic'] || 0;
        output.hit_det_automatic_total = valAutomatic;
      } else {
        console.log(`Change detected: Reset`);
        output.hit_det_automatic_total = 0;
        output.hit_det_automatic = 0;
      }
      setAttrs(output);
    });
  });

  // hit determination total
  on('change:hit_det_move_of_shooter_total change:hit_det_move_of_target_total change:hit_det_wounds_total change:hit_det_misc_total change:hit_det_automatic_total', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    getSectionIDs('repeating_weapons', (idArray) => {
      const output = {};
      const fields = ['hit_det_move_of_shooter_total', 'hit_det_move_of_target_total', 'hit_det_wounds_total', 'hit_det_misc_total', 'hit_det_automatic_total'];
      _.each(idArray, (id) => {
        fields.push(section_attribute('weapons', id, 'hit_det'));
      });
      getAttrs(fields, (v) => {
        const hit_det_move_of_shooter_total = +v.hit_det_move_of_shooter_total || 0;
        const hit_det_move_of_target_total = +v.hit_det_move_of_target_total || 0;
        const hit_det_wounds_total = +v.hit_det_wounds_total || 0;
        const hit_det_misc_total = +v.hit_det_misc_total || 0;
        const hit_det_automatic_total = +v.hit_det_automatic_total || 0;
        const hitDetTotal = hit_det_move_of_shooter_total + hit_det_move_of_target_total + hit_det_wounds_total + hit_det_misc_total + hit_det_automatic_total;
        output.hit_det_total = hitDetTotal;
        idArray.forEach((id) => {
          output[section_attribute('weapons', id, 'hit_det')] = hitDetTotal;
        });
        setAttrs(output, {silent: true});
      });
    });
  });

  // enables drag/drop of action buttons by syncing with a normal button
  // non-repeating buttons
  const buttonSet = [];
  on('change:character_name sheet:opened', (eventInfo) => {
    getSectionIDs('repeating_weapons', (idArrayWeapons) => {
      getAttrs(['character_name'], (v) => {
        let allAttributeValues = {};
        // process non-repeating buttons
        allAttributeValues = buttonSet.reduce((all, one) => {
          return {...all, [one]: `%{${v.character_name}|${one}-button}`};
        }, {});
        // process each repeating sections buttons
        idArrayWeapons.forEach((id) => {
          // repeating buttons
          const repeatingButtonSet = ['attack'];
          const attribute_values = repeatingButtonSet.reduce((all, one) => {
            return {...all, [`repeating_weapons_${id}_${one}`]: `%{${v.character_name}|repeating_weapons_${id}_${one}-button}`};
          }, {});
          allAttributeValues = {...allAttributeValues, ...attribute_values};
        });
        setAttrs(allAttributeValues, {silent: true});
      });
    });
  });

  // attack roll CRP act_attack
  on('clicked:repeating_weapons:attack-button', (eventInfo) => {
    console.log(`Change detected: ${eventInfo.sourceAttribute}`);
    const trigger = eventInfo.triggerName.replace('clicked:', '').replace('attack-button', '');
    const id = eventInfo.sourceAttribute.split('_')[2];
    console.log(`Change detected: trigger:${trigger}`);
    const output = {};
    // QUERY
    startRoll(`!{{template:default}}{{ask=![[?{Range to target?|PB,0|S,1|M,2|L,3}]]}}`, (question) => {
      const query = question.results.ask.result;
      console.log(question);
      if (query === 0) {
        const roll_string = `&{template:default} {{name=@{character_name} - Attack}} {{Attack Roll=[[1d100cs<@{${trigger}BaseAccuracy} [base] + (@{${trigger}RangeModifierPB} [range]) + (@{${trigger}hit_det} [hit det]) + (?{Additional Modifier|0} [mod]) ]] vs [[ @{${trigger}BaseAccuracy} [base] + (@{${trigger}RangeModifierPB} [range]) + (@{${trigger}hit_det} [hit det]) + (?{Additional Modifier|0} [mod]) ]]}} {{Base Accuracy=[[@{${trigger}BaseAccuracy}]]}} {{Range Mod=[[@{${trigger}RangeModifierPB}]] PB}} {{Hit Det=[[@{${trigger}hit_det}]]}} {{Mod=[[?{Additional Modifier|0}]]}}`;
        startRoll(roll_string, (attack_roll) => {
          console.log(attack_roll);
          // const result = attack_roll.results.attack.result;
          finishRoll(attack_roll.rollId);
          // reduce ammo?
          setAttrs(output);
        });
      } else {
        console.log(`Change detected: DO NOT ROLL`);
      }
    });
  });

  // one-time update
  on('sheet:opened', (eventInfo) => {
    console.log(`Change detected: sheet_version check`);
    getSectionIDs('repeating_AreasOfKnowledge', (idArray) => {
      const output = {};
      const fields = ['sheet_version', 'charactername', 'lifelevel', 'currentlifelevel'];
      _.each(idArray, (id) => {
        fields.push(section_attribute('AreasOfKnowledge', id, 'WeaponSpeedModifier'));
      });
      getAttrs(fields, (v) => {
        const sheetVersion = +v.sheet_version || 0;
        const characterName = v.charactername || 0;
        const oldLifeLevel = +v.lifelevel || 0;
        const oldCurrentLifeLevel = +v.currentlifelevel || 0;

        if (sheetVersion > 0) {
          console.log(`Change detected: sheet_version = ${sheetVersion}`);
          return;
        }
        if (characterName !== '') {
          console.log(`Change detected: character_name updated to ${characterName}`);
          output.character_name = characterName;
        }
        if (oldLifeLevel !== 0) {
          console.log(`Change detected: lifelevel has been changed to lifelevel_max`);
          output.lifelevel_max = oldLifeLevel;
        }
        if (oldCurrentLifeLevel !== 0) {
          console.log(`Change detected: currentlifelevel has been changed to lifelevel`);
          output.lifelevel = oldCurrentLifeLevel;
        }
        idArray.forEach((id) => {
          const currentValue = v[section_attribute('AreasOfKnowledge', id, 'WeaponSpeedModifier')];
          console.log(`Change detected: AreasOfKnowledgeName updated to ${currentValue}`);
          output[section_attribute('AreasOfKnowledge', id, 'AreasOfKnowledgeName')] = currentValue;
        });
        output.sheet_version = 1;
        console.log(`Change detected: Sheet update complete`);
        setAttrs(output, {silent: true});
      });
    });
  });
</script>